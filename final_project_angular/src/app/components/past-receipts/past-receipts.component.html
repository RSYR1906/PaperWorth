<!-- src/app/components/past-receipts/past-receipts.component.html -->

<!-- Simplified Hero Section for Mobile -->
<section class="hero">
  <div class="hero-content">
    <h1>Past Receipts</h1>
    <p>View and manage your receipt history</p>
  </div>
</section>

<!-- Mobile-optimized Search and Filters -->
<div class="search-filters-container">
  <div class="search-bar">
    <input 
      type="text" 
      placeholder="Search merchants..." 
      [(ngModel)]="searchTerm"
      class="search-input"
    >
    <span class="search-icon">üîç</span>
  </div>
  
  <div class="filter-chips">
    <button 
      [class.active]="filters.dateRange === 'all'" 
      (click)="filters.dateRange = 'all'"
      class="filter-chip"
    >
      All Time
    </button>
    <button 
      [class.active]="filters.dateRange === 'this-month'" 
      (click)="filters.dateRange = 'this-month'"
      class="filter-chip"
    >
      This Month
    </button>
    <button 
      [class.active]="filters.dateRange === 'last-month'" 
      (click)="filters.dateRange = 'last-month'"
      class="filter-chip"
    >
      Last Month
    </button>
  </div>
  
  <div class="category-filter">
    <select [(ngModel)]="filters.category" class="category-select">
      <option *ngFor="let category of categories" [value]="category.id">
        {{ category.name }}
      </option>
    </select>
  </div>
</div>

<!-- Loading Indicator -->
<div class="loading-container" *ngIf="isLoading">
  <div class="spinner"></div>
  <p>Loading your receipts...</p>
</div>

<!-- Error Message -->
<div class="error-message" *ngIf="error && !isLoading">
  <p>{{ error }}</p>
  <button class="action-btn" (click)="loadUserReceipts()">Retry</button>
</div>

<!-- Empty State -->
<div class="empty-state" *ngIf="filteredReceipts.length === 0 && !isLoading && !error">
  <div class="empty-icon">üßæ</div>
  <h3>No Receipts Found</h3>
  <p>No receipts match your current filters</p>
  <button class="action-btn primary" routerLink="/homepage">Scan New Receipt</button>
</div>

<!-- Receipts List for Mobile -->
<div class="receipts-list" *ngIf="filteredReceipts.length > 0 && !isLoading">
  <div 
    *ngFor="let receipt of filteredReceipts" 
    class="receipt-card"
    (click)="viewReceiptDetails(receipt)"
  >
    <div class="receipt-details">
      <div class="receipt-merchant">{{ receipt.merchantName }}</div>
      <div class="receipt-info">
        <span class="receipt-category">{{ receipt.category }}</span>
        <span class="receipt-date">{{ formatDate(receipt.dateOfPurchase) }}</span>
      </div>
    </div>
    <div class="receipt-amount">${{ receipt.totalAmount.toFixed(2) }}</div>
    <div *ngIf="receipt.hasPromotion" class="promo-badge">üè∑Ô∏è</div>
  </div>
</div>

<!-- Receipt Details Modal -->
<div class="mobile-modal" *ngIf="selectedReceipt" [class.visible]="selectedReceipt">
  <div class="modal-header">
    <h3 class="modal-title">Receipt Details</h3>
    <button class="modal-close" (click)="closeReceiptDetails()">√ó</button>
  </div>
  
  <div class="modal-body">
    <!-- Receipt Image (if available) -->
    <div class="receipt-image-container" *ngIf="selectedReceipt.imageUrl">
      <img [src]="selectedReceipt.imageUrl" alt="Receipt Image" class="receipt-image">
    </div>
    
    <!-- Receipt Information -->
    <div class="receipt-info-card">
      <div class="info-row">
        <div class="info-label">Merchant</div>
        <div class="info-value">{{ selectedReceipt.merchantName }}</div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Date</div>
        <div class="info-value">
          {{ formatDate(selectedReceipt.dateOfPurchase) }}
          <span class="info-time">{{ formatTime(selectedReceipt.dateOfPurchase) }}</span>
        </div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Category</div>
        <div class="info-value">{{ selectedReceipt.category }}</div>
      </div>
      
      <div class="info-row">
        <div class="info-label">Total</div>
        <div class="info-value info-total">${{ selectedReceipt.totalAmount.toFixed(2) }}</div>
      </div>
    </div>
    
    <!-- Receipt Items (if available) -->
    <div class="receipt-items-list" *ngIf="selectedReceipt.items && selectedReceipt.items.length > 0">
      <h4>Items</h4>
      
      <div class="item-row" *ngFor="let item of selectedReceipt.items">
        <div class="item-name">{{ item.name }}</div>
        <div class="item-details">
          <span class="item-qty" *ngIf="item.quantity > 1">{{ item.quantity }} √ó</span>
          <span class="item-price">${{ item.price.toFixed(2) }}</span>
        </div>
      </div>
      
      <div class="items-total">
        <span>Total</span>
        <span>${{ selectedReceipt.totalAmount.toFixed(2) }}</span>
      </div>
    </div>
    
    <!-- Related Promotions Badge (if available) -->
    <div class="promotions-badge" *ngIf="selectedReceipt.hasPromotion">
      <div class="badge-icon">üè∑Ô∏è</div>
      <div class="badge-content">
        <div class="badge-title">Promotions Available!</div>
        <p>This merchant has promotions you might like</p>
      </div>
      <button 
        class="badge-action" 
        [routerLink]="['/promotions']" 
        [queryParams]="{merchant: selectedReceipt.merchantName}"
      >
        View
      </button>
    </div>
  </div>
  
  <div class="modal-footer">
    <button class="action-btn secondary" (click)="closeReceiptDetails()">Close</button>
    <button class="action-btn danger" (click)="deleteReceipt(selectedReceipt)">Delete</button>
  </div>
</div>
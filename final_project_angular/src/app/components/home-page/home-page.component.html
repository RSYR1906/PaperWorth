<!-- src/app/components/home-page/home-page.component.html -->
<!-- Main Content Container -->
<div class="app-container">
  <!-- Compact Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1>Save More with Every Receipt!</h1>
      <p>Scan your receipts to unlock exclusive deals and track your expenses.</p>
    </div>
  </section>

  <!-- Dashboard Card -->
  <div class="dashboard-card">
    <div class="user-info">
      <h2>Welcome, {{ userName$ | async }}</h2>
      <p>Total Monthly Expenses: <strong>${{ monthlyExpenses$ | async }}</strong></p>
    </div>

    <div class="rewards-promo">
      <div class="rewards-icon">üéÅ</div>
      <div class="rewards-text">
        <h3>PaperWorth Rewards</h3>
        <p>Earn points from scanning receipts and redeem for exciting rewards!</p>
      </div>
      <a routerLink="/rewards" class="view-rewards-btn">View Rewards</a>
    </div>
  </div>

  <!-- SAVED PROMOTIONS SECTION -->
  <div class="promotions-section" *ngIf="!cameraService.isProcessing && !(receiptProcessingService.processing$ | async)">
    <div class="section-header">
      <h3>Your Saved Promotions</h3>
      <a routerLink="/saved-promotions" class="view-all">View All <span class="arrow-icon">‚Üí</span></a>
    </div>
    
    <!-- Loading Indicator -->
    <div *ngIf="(isLoading$ | async)?.savedPromotions" class="loading-indicator">
      <div class="spinner"></div>
      <p>Loading your saved promotions...</p>
    </div>
    
    <!-- Empty State -->
    <ng-container *ngIf="savedPromotions$ | async as savedPromotions">
      <div class="empty-state" *ngIf="!(isLoading$ | async)?.savedPromotions && savedPromotions.length === 0">
        <div class="empty-icon">üè∑Ô∏è</div>
        <h4>No Saved Promotions</h4>
        <p>You haven't saved any promotions yet. Browse the available promotions and save the ones you like!</p>
        <button class="action-btn primary" routerLink="/promotions">Browse Promotions</button>
      </div>
      
      <!-- Saved Promotions List - Horizontal Scrollable -->
      <div class="saved-promotions-scroll" *ngIf="!(isLoading$ | async)?.savedPromotions && savedPromotions.length > 0">
        <ng-container *ngIf="displayedSavedPromotions$ | async as displayedPromotions">
          <div class="promo-card" *ngFor="let promo of displayedPromotions">
            <!-- Expiry Badge -->
            <div class="expiry-badge" 
                *ngIf="isExpiringSoon(promo.expiry) && !hasExpired(promo.expiry)">
              Expires Soon
            </div>
            <div class="expiry-badge expired" *ngIf="hasExpired(promo.expiry)">
              Expired
            </div>
            
            <!-- Card Content -->
            <div class="promo-image" (click)="viewPromotionDetails(promo)">
              <img [src]="promo.imageUrl" 
                  [alt]="promo.merchant + ' promotion'" 
                  onerror="this.src='promo-placeholder.jpg'">
            </div>
            <div class="promo-content">
              <div class="promo-merchant">{{ promo.merchant }}</div>
              <div class="promo-description" (click)="viewPromotionDetails(promo)">
                {{ promo.description }}
              </div>
              <div class="promo-meta">
                <div class="promo-expiry" [class.expired-text]="hasExpired(promo.expiry)">
                  Valid until: {{ formatDate(promo.expiry) }}
                </div>
                <div class="promo-code" *ngIf="promo.code">Code: {{ promo.code }}</div>
              </div>
            </div>
            <div class="promo-actions">
              <button class="view-btn" (click)="viewPromotionDetails(promo)">View</button>
              <button class="remove-btn" (click)="removeSavedPromotion(promo.id)">Remove</button>
            </div>
          </div>
        </ng-container>
      </div>

      <!-- Show More/Less Button -->
      <div class="show-more-container" *ngIf="savedPromotions.length > 3">
        <button class="show-more-btn" (click)="toggleShowMoreSavedPromotions()">
          {{ (showMoreSavedPromotions$ | async) ? 'Show Less' : 'Show More' }}
        </button>
      </div>
    </ng-container>
  </div>

  <!-- PROMOTIONS SECTION -->
  <div class="promotions" *ngIf="!cameraService.isProcessing && !(receiptProcessingService.processing$ | async)">
    <!-- Loading promotions indicator -->
    <div *ngIf="(isLoading$ | async)?.promotions" class="loading-promotions">
      <div class="spinner"></div>
      <p>Finding matching promotions...</p>
    </div>

    <!-- Recommendations Section -->
    <div class="recommendations-section">
      <h3 class="personalized-title">Recommended For You</h3>
      
      <!-- Loading indicator for recommendations -->
      <div *ngIf="(isLoading$ | async)?.receipts" class="loading-promotions">
        <div class="spinner"></div>
        <p>Preparing your personalized recommendations...</p>
      </div>
      
      <!-- Personalized recommendations based on receipt history -->
      <ng-container *ngIf="!(isLoading$ | async)?.receipts">
        <ng-container *ngIf="recommendedPromotions$ | async as recommendedPromotions">
          <div *ngFor="let category of recommendedPromotions" class="category-section">
            <div class="category-header">
              <h4>{{ category.name }}</h4>
            </div>
            
            <!-- Horizontal scrollable promotions list -->
            <div class="promo-scroll-container">
              <div class="promo-list">
                <div *ngFor="let promo of category.deals" class="promo-card" (click)="viewPromotionDetails(promo)">
                  <img [src]="promo.imageUrl" 
                      alt="Promo Image" 
                      onerror="this.src='placeholder-image.jpg'">
                  <div class="promo-content">
                    <div class="promo-merchant" *ngIf="promo.merchant">{{ promo.merchant }}</div>
                    <p class="promo-title">{{ promo.description }}</p>
                    <p class="expiry">Valid until: {{ formatDate(promo.expiry) }}</p>
                    <div class="promo-code" *ngIf="promo.code">Code: <span>{{ promo.code }}</span></div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Empty state for a category with no promotions -->
            <div *ngIf="!category.deals || category.deals.length === 0" class="no-deals-message">
              <p>No current deals available for {{ category.name }}</p>
            </div>
          </div>
          
          <!-- Empty state if no recommendations at all -->
          <div *ngIf="recommendedPromotions.length === 0" class="no-recommendations">
            <p>Scan more receipts to get personalized recommendations!</p>
          </div>
        </ng-container>
      </ng-container>
    </div>
  </div>

  <!-- Success Notification -->
  <div class="success-notification" *ngIf="showSuccessNotification$ | async">
    <div class="notification-content">
      <span class="success-icon">‚úì</span>
      <p>{{ successNotificationMessage$ | async }}</p>
      <div class="timer-bar">
        <ng-container *ngIf="notificationTimeRemaining$ | async as timeRemaining">
        <div class="timer-progress" [style.width.%]="timeRemaining * 10"></div>
      </ng-container>
      </div>
    </div>
    <button class="close-notification" (click)="closeSuccessNotification()">√ó</button>
  </div>

  <!-- OCR Text Toggle Button (if needed) -->
  <button *ngIf="cameraService.isProcessing || (receiptProcessingService.processing$ | async)" 
          class="toggle-text-btn" 
          (click)="toggleFullText()">
    {{ (store.showFullText$ | async) ? 'Hide Full Text' : 'Show Full Text' }}
  </button>

  <!-- Promotion details modal - Consistent with saved-promotions style -->
  <div *ngIf="selectedPromotion$ | async as promotion" class="promotion-modal-overlay" (click)="closePromotionDetails()">
    <div class="promotion-modal" (click)="$event.stopPropagation()">
      <button class="close-button" (click)="closePromotionDetails()">√ó</button>
      
      <div class="modal-content">
        <div class="modal-image">
          <img [src]="promotion.imageUrl || 'placeholder-image.jpg'" 
               alt="Promotion Image"
               onerror="this.src='placeholder-image.jpg'">
        </div>
        
        <div class="modal-details">
          <p class="merchant-name">{{promotion.merchant}}</p>
          <p class="description-text">{{promotion.description}}</p>
          
          <!-- Promo code if available -->
          <div *ngIf="promotion.code" class="promo-code-container">
            <h3>Promotion Code:</h3>
            <div class="promo-code">
              <span>{{promotion.code}}</span>
            </div>
          </div>
          
          <div *ngIf="promotion.location" class="location-info">
            <p><strong>Location:</strong> {{promotion.location}}</p>
          </div>
          
          <div *ngIf="promotion.conditions" class="terms-conditions">
            <h3>Terms & Conditions</h3>
            <p>{{promotion.conditions}}</p>
          </div>
          
          <div *ngIf="promotion.category" class="category-info">
            <span class="category-badge">{{promotion.category}}</span>
          </div>
          
          <!-- Save or Remove button based on saved status -->
          <ng-container *ngIf="(isSavedPromotion(promotion) | async) as isSaved">
            <button *ngIf="!isSaved" 
                    class="save-promotion-btn" 
                    (click)="savePromotion(promotion)">
              Save Promotion
            </button>
            <button *ngIf="isSaved" 
                    class="remove-promotion-btn" 
                    (click)="removeSavedPromotion(promotion.id)">
              Remove from Saved
            </button>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>
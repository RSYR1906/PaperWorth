<!-- Updated home-page.component.html -->
<div class="home-container">
  <!-- Header Section -->
  <header class="dashboard-header">
    <div class="user-welcome">
      <h1>Hello, {{ store.userFirstName$ | async }}!</h1>
      <p>Welcome to your expense dashboard</p>
    </div>
    <div class="monthly-expenses-card">
      <h3>Monthly Expenses</h3>
      <div class="expense-amount" *ngIf="!(store.isLoadingBudget$ | async); else loadingBudget">
        ${{ store.formatCurrency((store.monthlyExpenses$ | async) || 0) }}
      </div>
      <ng-template #loadingBudget>
        <div class="loading-indicator">Loading...</div>
      </ng-template>
    </div>
    <button class="logout-button" (click)="logout()">Logout</button>
  </header>

  <!-- Main Content Section -->
  <div class="dashboard-content">
    <!-- Receipt Scanner Card -->
    <div class="card scanner-card">
      <h2>Receipt Scanner</h2>
      
      <!-- Upload Area -->
      <div class="upload-area" *ngIf="!(store.imagePreview$ | async)">
        <input type="file" accept="image/*" (change)="onFileSelected($event)" hidden>
        
        <div class="upload-options">
          <div class="upload-option" (click)="triggerFileInput()">
            <i class="upload-icon"></i>
            <p>Upload from gallery</p>
          </div>
          
          <div class="upload-option" (click)="openCamera()">
            <i class="camera-icon"></i>
            <p>Take a photo</p>
          </div>
        </div>
      </div>
      
      <!-- Image Preview & OCR Results -->
      <div class="scanner-results" *ngIf="store.imagePreview$ | async">
        <div class="image-preview">
          <img [src]="store.imagePreview$ | async" alt="Receipt preview">
        </div>
        
        <ng-container *ngIf="!(store.isProcessing$ | async); else processingTemplate">
          <div class="extracted-data" *ngIf="store.extractedData$ | async as extractedData">
            <h3>Extracted Data</h3>
            <div class="data-row">
              <span class="label">Merchant:</span>
              <span class="value">{{ extractedData.merchantName }}</span>
            </div>
            <div class="data-row">
              <span class="label">Amount:</span>
              <span class="value">${{ store.formatCurrency(extractedData.totalAmount) }}</span>
            </div>
            <div class="data-row">
              <span class="label">Date:</span>
              <span class="value">{{ store.formatDate(extractedData.dateOfPurchase) }}</span>
            </div>
            
            <div class="ocr-text-container">
              <div class="ocr-toggle" (click)="toggleFullText()">
                {{ (store.showFullText$ | async) ? 'Hide OCR Text' : 'Show OCR Text' }}
              </div>
              <div class="ocr-text" *ngIf="store.showFullText$ | async">
                {{ store.ocrText$ | async }}
              </div>
            </div>
          </div>
          
          <div class="scanner-actions">
            <button class="scan-btn" *ngIf="!(store.extractedData$ | async)" (click)="uploadImage()">
              Scan Receipt
            </button>
            <button class="save-btn" *ngIf="store.extractedData$ | async" (click)="saveReceipt()">
              Save Receipt
            </button>
            <button class="reset-btn" (click)="store.resetScanner()">
              New Scan
            </button>
          </div>
        </ng-container>
      </div>
      
      <!-- Processing Template -->
      <ng-template #processingTemplate>
        <div class="processing-indicator">
          <div class="spinner"></div>
          <p>{{ (store.processingMessage$ | async) || 'Processing...' }}</p>
        </div>
      </ng-template>
    </div>
    
    <!-- Saved Promotions -->
    <div class="card promotions-card">
      <div class="card-header">
        <h2>Your Saved Promotions</h2>
        <span class="view-all" *ngIf="(store.savedPromotions$ | async)?.length > 3" (click)="toggleShowMoreSavedPromotions()">
          {{ (store.showMoreSavedPromotions$ | async) ? 'Show Less' : 'View All' }}
        </span>
      </div>
      
      <div class="card-content">
        <div class="loading-indicator" *ngIf="store.isLoadingSavedPromotions$ | async">
          Loading your promotions...
        </div>
        
        <div class="no-promotions" *ngIf="(store.displayedSavedPromotions$ | async)?.length === 0 && !(store.isLoadingSavedPromotions$ | async)">
          <p>You don't have any saved promotions yet.</p>
        </div>
        
        <div class="promotion-items" *ngIf="(store.displayedSavedPromotions$ | async)?.length > 0">
          <div class="promotion-item" *ngFor="let promo of (store.displayedSavedPromotions$ | async)">
            <div class="promo-details" (click)="viewPromotionDetails(promo)">
              <h3>{{ promo.title }}</h3>
              <div class="merchant">{{ promo.merchant }}</div>
              <div class="expiry" [ngClass]="{
                'expiring-soon': store.isExpiringSoon(promo.expiryDate),
                'expired': store.hasExpired(promo.expiryDate)
              }">
                <span *ngIf="store.hasExpired(promo.expiryDate)">Expired</span>
                <span *ngIf="store.isExpiringSoon(promo.expiryDate) && !store.hasExpired(promo.expiryDate)">
                  Expires soon: {{ store.formatDate(promo.expiryDate) }}
                </span>
                <span *ngIf="!store.isExpiringSoon(promo.expiryDate) && !store.hasExpired(promo.expiryDate)">
                  Expires: {{ store.formatDate(promo.expiryDate) }}
                </span>
              </div>
            </div>
            <button class="delete-btn" (click)="removeSavedPromotion(promo.id)">
              <i class="delete-icon"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Recommended Promotions -->
    <div class="card recommended-card">
      <h2>Recommended For You</h2>
      
      <div class="loading-indicator" *ngIf="store.isLoadingRecommendations$ | async">
        Finding promotions for you...
      </div>
      
      <div class="no-recommendations" *ngIf="(store.recommendedPromotions$ | async)?.length === 0 && !(store.isLoadingRecommendations$ | async)">
        <p>We're still learning your preferences. Check back after scanning more receipts!</p>
      </div>
      
      <div class="recommendation-categories" *ngIf="(store.recommendedPromotions$ | async)?.length > 0">
        <div class="category-group" *ngFor="let category of (store.recommendedPromotions$ | async)">
          <h3 class="category-name">{{ category.name }}</h3>
          
          <div class="promotion-items">
            <div class="promotion-item" *ngFor="let promo of category.deals">
              <div class="promo-details" (click)="viewPromotionDetails(promo)">
                <h4>{{ promo.title }}</h4>
                <div class="merchant">{{ promo.merchant }}</div>
                <div class="discount">{{ promo.discount }}</div>
                <div class="expiry" [ngClass]="{
                  'expiring-soon': store.isExpiringSoon(promo.expiryDate),
                  'expired': store.hasExpired(promo.expiryDate)
                }">
                  Expires: {{ store.formatDate(promo.expiryDate) }}
                </div>
              </div>
              <button class="save-promo-btn" (click)="savePromotion(promo)">
                <i class="save-icon"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Promotion Details Modal -->
  <div class="promotion-modal" *ngIf="store.selectedPromotion$ | async as promotion">
    <div class="modal-overlay" (click)="closePromotionDetails()"></div>
    <div class="modal-content">
      <button class="close-modal" (click)="closePromotionDetails()">×</button>
      
      <div class="promotion-header">
        <h2>{{ promotion.title }}</h2>
        <div class="merchant">{{ promotion.merchant }}</div>
      </div>
      
      <div class="promotion-body">
        <div class="discount-details">
          <div class="discount">{{ promotion.discount }}</div>
          <div class="expiry" [ngClass]="{
            'expiring-soon': store.isExpiringSoon(promotion.expiryDate),
            'expired': store.hasExpired(promotion.expiryDate)
          }">
            <span *ngIf="store.hasExpired(promotion.expiryDate)">Expired on {{ store.formatDate(promotion.expiryDate) }}</span>
            <span *ngIf="!store.hasExpired(promotion.expiryDate)">Expires on {{ store.formatDate(promotion.expiryDate) }}</span>
          </div>
        </div>
        
        <div class="description">
          {{ promotion.description }}
        </div>
        
        <div class="terms">
          <h4>Terms & Conditions</h4>
          <p>{{ promotion.terms || 'No specific terms provided.' }}</p>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="save-btn" (click)="savePromotion(promotion)">Save Promotion</button>
      </div>
    </div>
  </div>
  
  <!-- Success Notification -->
  <div class="success-notification" *ngIf="store.showSuccessNotification$ | async">
    <div class="notification-content">
      <div class="success-icon"></div>
      <p>{{ store.successNotificationMessage$ | async }}</p>
      <button class="close-notification" (click)="closeSuccessNotification()">×</button>
    </div>
    <div class="notification-progress-bar">
      <div class="progress" [style.width.%]="store.notificationTimeRemaining$ | async"></div>
    </div>
  </div>
</div>